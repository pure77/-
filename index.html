<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="index.css" />
    <title>Calendar with Categories</title>
  </head>
  <body>
    <nav class="navbar">
      <h2>하루느루</h2>
      <a
        href="javascript:void(0);"
        class="navbar_menu_toggleBtn"
        onclick="toggleMenu()"
        id="menuIcon"
      >
        <i class="fa-solid fa-bars"></i>
      </a>
    </nav>
    <nav class="navbar_menu" id="navbarMenu">
      <ul class="navbar_menu_list">
        <a href="addCategory.html"><li>카테고리 등록</li></a>
        <a href="managementCategory.html"><li>카테고리 관리</li></a>
      </ul>
    </nav>

    <section class="container">
      <section class="color_cal_planner-contrainer">
        <section class="color-container">
          <h3>color</h3>
        </section>
        <section class="calendar-container">
          <section class="month-header">
            <span>2024년 10월</span>
            <span class="mood-icons">🐱 0 😃 0 ❤️ 0</span>
            <section class="nav-buttons">
              <button onclick="prevMonth()">&#10094;</button>
              <button onclick="nextMonth()">&#10095;</button>
            </section>
          </section>
          <section class="weekdays">
            <span>월</span>
            <span>화</span>
            <span>수</span>
            <span>목</span>
            <span>금</span>
            <span class="saturday">토</span>
            <span class="sunday">일</span>
          </section>
          <section class="days" id="days">
            <!-- Days will be dynamically generated by JavaScript -->
          </section>
        </section>
        <section class="month_week-container">
          <h3>Month/Week</h3>
          <div class="category-item">
            <span>Month</span>
            <button class="addTaskButton">+</button>
            <div class="taskList" id="monthTaskList"></div>
          </div>
          <div class="category-item">
            <span>Week</span>
            <button class="addTaskButton">+</button>
            <div class="taskList" id="weekTaskList"></div>
          </div>
        </section>
      </section>
      <section class="category-container">
        <h3>Feed</h3>
        <section id="categoryList">
          <!-- Categories will be dynamically generated here -->
        </section>
      </section>
    </section>

    <script
      src="https://kit.fontawesome.com/00ff3a61fe.js"
      crossorigin="anonymous"
    ></script>
    <script>
      // Function to load categories from localStorage and display in the feed
      function loadCategories() {
        const categoryList = document.getElementById("categoryList");
        categoryList.innerHTML = ""; // Clear existing categories
        const categories = JSON.parse(localStorage.getItem("categories")) || [];

        categories.forEach((category) => {
          const categoryDiv = document.createElement("div");
          categoryDiv.classList.add("category-item");
          categoryDiv.innerHTML = `
                  <span>${category.title}</span>
                  <button class="addTaskButton">+</button>
                  <div class="taskList"></div> <!-- Container for tasks -->
              `;

          // Add task input area when "+" button is clicked
          categoryDiv
            .querySelector(".addTaskButton")
            .addEventListener("click", function () {
              const taskList = categoryDiv.querySelector(".taskList");
              addTask(taskList); // Pass the actual taskList element
            });

          categoryList.appendChild(categoryDiv);
        });
      }

      // Add task function that can be used for both Month/Week and Feed sections
      function addTask(taskList) {
        // Create a new task item with checkbox and input field
        const taskItem = document.createElement("div");
        taskItem.classList.add("task-item");
        taskItem.innerHTML = `
              <input type="checkbox" class="task-checkbox" />
              <input type="text" placeholder="할 일 입력" class="task-input" />
          `;

        // Select the input field within the new task item
        const taskInput = taskItem.querySelector(".task-input");
        // Disable editing when Enter is pressed or when the input loses focus
        taskInput.addEventListener("blur", () => {
          if (taskInput.value.trim() !== "") {
            taskInput.classList.add("completed"); // Add class to remove underline
          }
        });

        taskInput.addEventListener("keypress", (event) => {
          if (event.key === "Enter" && taskInput.value.trim() !== "") {
            taskInput.classList.add("completed"); // Add class to remove underline on Enter
            // Optionally, you could also trigger blur here
            taskInput.blur(); // Trigger the blur event if you want to lose focus
          }
        });

        // Append the task item to the task list
        taskList.appendChild(taskItem);
      }

      // Add task function for Month section
      function addMonthTask() {
        const monthTaskList = document.getElementById("monthTaskList");
        addTask(monthTaskList); // Call addTask with the correct task list
      }

      // Add task function for Week section
      function addWeekTask() {
        const weekTaskList = document.getElementById("weekTaskList");
        addTask(weekTaskList); // Call addTask with the correct task list
      }

      // Load categories on page load
      window.onload = loadCategories;

      // Hook up the buttons in Month/Week section to the add task functions
      document
        .querySelectorAll(".month_week-container .addTaskButton")
        .forEach((button) => {
          button.addEventListener("click", (event) => {
            if (
              event.target.closest(".category-item").querySelector("span")
                .innerText === "Month"
            ) {
              addMonthTask();
            } else {
              addWeekTask();
            }
          });
        });
    </script>

    <script src="index.js"></script>
  </body>
</html>
